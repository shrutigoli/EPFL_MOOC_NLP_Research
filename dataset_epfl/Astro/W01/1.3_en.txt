The Virial theorem is to random motion what Kepler's laws are to planar motion.
It relates the kinetic energy to the potential energy of
Â« self-gravitating Â» systems, that is systems under the influence of their own gravitational field and isolated from any external gravitational field.
Such systems include globular clusters or more generally stellar clusters, such as Omega Centauri, shown here.
Its mass, 1.5 million solar masses, can be measured by applying the Virial theorem.
Lets demonstrate the
Virial theorem in the following which says that the time average of twice the kinetic energy is equal to the time average of the potential energy.
Let us consider a quantity S equals to the sum over all particles k of the momenta times the radius vectors.
This is the projection of all the momenta vectors along the radius vectors of all particles.
As both the radius vectors and the velocities are distributed randomly around a centre of gravity common to all particles, the time variation of S oscillates around a mean value of zero.
Therefore the derivative also oscillates around a mean value of zero.
The time average of dS/dt must then be zero.
Let us compute this derivative.
We have the sum of two mean values.
One of them is the average of the potential energy and the other is twice the average of the kinetic energy as we are going to show.
Let us rewrite the equation seen previously.
Here we have simply separated the two terms of the equation.
We immediately recognize the velocity vector.
P can be expressed as a function of the velocity.
We have thus m v_k times v_k.
The vector v_k is obviously collinear with v_k and we recognize immediately minus two times the average of the kinetic energy of the particles.
We now have to show that the other side of the equation is the time average of the potential energy.
This is what we are going to see now.
Let us rewrite this side.
We recognize here the force which must be the gravitational force since we have a central force.
The gravitational force.
If we can show that this term is minus the potential energy then we will have proven the Virial theorem.
This is the same term as before. 
We know know that we have a gravitational force which is a force that can be derived from a potential.
We can therefore choose a potential.
Let us call it Ï• (r).
It is proportional to the radius raised to a certain power.
For gravity, n = -2 so the potential depends on -1/r
Let us rewrite the force in this way here.
What we have really written is the derivative of the potential with respect to the radius with the potential that we chose here.
We can now rewrite the sum over k of all vectors F_k r_k
We now have n+1 at the exponent since we multiplied by the radius.
We can therefore immediately identify the potential since we have here the same term as in the potential and r^(n+1)  here.
We can then rewrite this term as a function of the potential.
We immediately recognise the potential energy.
For easier notation, we previously removed the bracket representing the time average.
We didn't make any calculation that would make this average disappear so we put the brackets back at the end here.
We have thus proven the Virial theorem.
The Virial theorem is extremely useful in astrophysics because we have on one side the mass of the bodies through their potential energy (U) and on the other side we can generally express the kinetic energy in two different ways.
A first way is as a function of the body's temperature.
If we consider for example a gas cloud at a given temperature then we have 1/2 n k T with k the Boltzmann constant and T the temperature per degree of freedom.
K is then equal to 1/2 k T per degree of freedom.
For example if we have three dimensions and n particles, then K = 3/2 n k T with K the Boltzmann constant and T the temperature.
If we consider a gas cloud at a given temperature T with n particles, then we can express its kinetic energy in this way.
We can also express it in the more usual way of being the sum of the kinetic energies of all particles, that is 1/2 m_k (v_k)Â².
For example, if we have a cloud of particles and we know all the velocities or the velocity distribution then we can express the kinetic energy in this way.
We just saw how to express the kinetic energy.
Now let us have a look at how to express the potential energy.
To this end, we greatly simplify the body of interest.
Lets take a spherical approximation.
This spherical body has a given density Ï± which does not depend on the radius.
In other words, Ï± is constant.
We now stack spherical shells of density Ï± from the infinity to a given radius r to form a body with a total mass (M) and a final radius (R) once we stacked all the spherical shells.
The variation of the potential energy due to the stacking of all the spherical shells is equal to the work of the gravitational force to bring a shell from infinity to the radius r.
We will first compute this work to bring the shell from here to there before integrating, that is summing over the works of the gravitational forces to bring all the spherical shells from infinity to  r.
Let us have a first look on how to integrate the gravitational force from infinity to a given radius r.
The force is the gravitational force between the mass m(r) and the spherical shell with mass dm located at a distance s from the sphere of radius r.
We integrate this with respect to the bound variable s.
The result of this integral is completely obvious.
This term evaluated between infinity and r gives a variation of the potential energy.
We have thus computed the variation of the potential energy when the gravitational force works to go from infinity to a radius r.
In order to get the total potential energy, we have to sum over all the elementary potential energies that we computed previously from 0 to the final radius R of the body we are interested in getting the potential energy.
This is the variation of the potential energy that we just computed.
Let us rewrite it.
We can give an explicit form to this term "dm" by assuming as said earlier that the mass density in the spherical shell and in the sphere here is constant.
We have G m(r) / r.
The term dm is the surface of the sphere times its density and thickness.
We now have an integral that only depends on r and that we can thus compute.
We still have to make a last assumption.
Since we assumed the density of the body we are interested in to be constant, we can assume its mass to be
4/3 Ï€ RÂ³ Ï±.
In the same way, the the m(r) here can be expressed as 4/3 Ï€ rÂ³ Ï±
We have here a lower case r for the small sphere and an upper case R as the final radius of the star or body we are interested in.
If we use this to end the calculation we get that the potential energy of a sphere is  -3/5 G MÂ²/R where M is the total mass of the body and R the final radius.
Just like Kepler's laws, the Virial theorem will appear many times during the course.
It is essential in order to link the masses of the studied bodies to velocities or velocity distributions.
It is useful in the case of stellar clusters where the velocities of the stars can be measured, such as here with Omega Centauri cluster.
It is also the case for stars in galaxies or even for galaxies in galaxy clusters such as the one here.
All these astronomical bodies can be weighed in order to determine their mass through the measurement of velocities or velocity distributions by using the Virial theorem.
